
## Исправление доступа к файлам для пользователя

### Проблема
1. **Протоколы**: Кнопка "Открыть файл" в протоколах не открывает реальный файл -- она просто показывает уведомление. Файл из базы данных (`file_url`) не передаётся в компонент.
2. **Админка -- ссылки на файлы дорожных карт**: В админке ссылка на файл карты использует `file_url` напрямую как URL, но бакет приватный, поэтому ссылка не работает.
3. **Старые данные**: Некоторые протоколы в базе хранят полный публичный URL вместо относительного пути -- их нужно исправить.

### Что будет сделано

**1. Протоколы -- пользовательская часть**
- Добавить поле `fileUrl` в тип `Protocol` (`src/types/mentoring.ts`)
- В `Index.tsx` при загрузке протоколов маппить `file_url` в `fileUrl`
- Переписать `ProtocolsTab.tsx`: убрать фиктивный `handleOpenFile`, добавить реальное открытие файла через подписанные ссылки (временные ссылки с ограниченным сроком действия, которые безопасно дают доступ к файлу на 1 час)
- Кнопка "Открыть файл" будет работать только если к протоколу прикреплён файл

**2. Админка -- ссылки на файлы дорожных карт**
- В `AdminClientView.tsx` заменить прямую ссылку `<a href={r.file_url}>` на кнопку, которая генерирует подписанную ссылку и открывает файл

**3. Очистка старых данных**
- SQL-миграция для исправления старых записей протоколов, где `file_url` содержит полный URL вместо относительного пути

### Технические детали

**Файлы для изменения:**
- `src/types/mentoring.ts` -- добавить `fileUrl?: string` в `Protocol`
- `src/pages/Index.tsx` -- маппинг `file_url` -> `fileUrl` для протоколов
- `src/tabs/ProtocolsTab.tsx` -- реальное открытие файлов через `supabase.storage.from('mentoring-files').createSignedUrl(path, 3600)`
- `src/pages/admin/AdminClientView.tsx` -- исправить ссылку на файл дорожной карты

**SQL-миграция:**
- Обновить `protocols.file_url` -- извлечь относительный путь из полных URL
