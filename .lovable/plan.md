

## Проблема: файлы открываются как about:blank

### Причина

Функция `openStorageFile` в `src/lib/openFile.ts` вызывает `supabase.storage.createSignedUrl()` без предварительной проверки свежести токена. После недавних изменений в `externalDb.ts` мы добавили проактивное обновление токена для API-запросов, но забыли сделать то же самое для запросов к хранилищу.

Цепочка:
1. Пользователь кликает "Открыть файл"
2. `window.open('', '_blank')` -- открывается пустое окно
3. `createSignedUrl()` отправляет запрос с просроченным токеном
4. Запрос возвращает ошибку -- signed URL не получен
5. `newWindow.close()` вызывается, но на мобильных/некоторых браузерах не закрывает окно
6. Результат: пользователь видит `about:blank`

### План исправления

#### `src/lib/openFile.ts`

1. Перед вызовом `createSignedUrl` проверить свежесть сессии через `supabase.auth.getSession()`
2. Если токен истёк или близок к истечению (менее 60 сек) -- вызвать `supabase.auth.refreshSession()`
3. Если `createSignedUrl` вернул ошибку -- показать toast-уведомление пользователю вместо молчаливого закрытия окна
4. Не открывать `window.open` до получения signed URL -- вместо этого сначала получить URL, потом открыть окно (альтернативный подход: оставить синхронное открытие, но показывать в окне промежуточную страницу загрузки)

Итоговая логика:
- Открыть окно синхронно (для обхода блокировщиков)
- Проверить/обновить токен
- Запросить signed URL
- Если успех -- перенаправить окно на URL
- Если ошибка -- закрыть окно + показать toast с сообщением об ошибке

### Затронутые файлы

- `src/lib/openFile.ts` -- добавить проверку токена и обработку ошибок

### Результат

- Файлы снова открываются корректно даже с просроченным токеном
- При ошибке пользователь видит понятное уведомление вместо пустой вкладки
